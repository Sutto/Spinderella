// spinderella-min.js
if(!this.JSON){this.JSON={}}(function(){function l(a){return a<10?'0'+a:a}if(typeof Date.prototype.toJSON!=='function'){Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+'-'+l(this.getUTCMonth()+1)+'-'+l(this.getUTCDate())+'T'+l(this.getUTCHours())+':'+l(this.getUTCMinutes())+':'+l(this.getUTCSeconds())+'Z':null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()}}var o=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,p=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,h,m,r={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},k;function q(c){p.lastIndex=0;return p.test(c)?'"'+c.replace(p,function(a){var b=r[a];return typeof b==='string'?b:'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+c+'"'}function n(a,b){var c,d,e,i,j=h,g,f=b[a];if(f&&typeof f==='object'&&typeof f.toJSON==='function'){f=f.toJSON(a)}if(typeof k==='function'){f=k.call(b,a,f)}switch(typeof f){case'string':return q(f);case'number':return isFinite(f)?String(f):'null';case'boolean':case'null':return String(f);case'object':if(!f){return'null'}h+=m;g=[];if(Object.prototype.toString.apply(f)==='[object Array]'){i=f.length;for(c=0;c0)this.subscribe(this.channels);if(this.identifier)this.identify(this.identifier)},processDisconnection:function(){},receiveData:function(a){this.buffer+=a;if(this.buffer.indexOf("\r\n")>=0){var b=this.buffer.split("\r\n");this.buffer=b.pop()||"";for(var c=0;c=0)this.channels.remove(d)}this.performAction("unsubscribe",{"channels":a})},identify:function(a){this.performAction("identify",{"identifier":a})}};Spinderella.Orbited=function(a,b,c,d,e){this.client=new Spinderella(a,b,c,d,e);this.client.socket=this}Spinderella.Orbited.prototype={reconnectOn:function(){return[Orbited.Errors.RemoteConnectionFailed,Orbited.Errors.UserConnectionReset,Orbited.Statuses.ServerClosedConnection]},onMessage:function(a){this.client.onMessage=a},connect:function(){this.socket=new TCPSocket();var b=this.client;var c=this;this.socket.onread=function(a){b.receiveData(a)};this.socket.onopen=function(){b.processConnection()};this.socket.onclose=function(a){c.onDisconnect(a)};this.socket.open(b.host,b.port)},onDisconnect:function(a){this.client.processDisconnection();if(this.reconnectOn().indexOf(a)>=0){var b=this;setTimeout(function(){b.connect()},5000)}},send:function(a){this.socket.send(a)}};